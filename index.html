<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script src="config.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„å¯æ„›æ°£è±¡</title>
    
    <!-- iPhone PWA è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon.png">

    <style>
        :root {
            --bg-color: #FFF9F0; /* æº«æš–çš„ç±³è‰²åº• */
            --card-bg: #FFFFFF;
            --text-main: #4A4A4A;
            --accent: #FF9F43; /* æº«æš–æ©˜ */
            --rain-color: #54A0FF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* å¯æ„›é¢¨æ ¼å®¹å™¨ */
        .weather-card {
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 360px;
            padding: 30px 20px;
            text-align: center;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        h1 { font-size: 1.2rem; margin-bottom: 5px; color: #888; font-weight: normal;}
        .location { font-size: 2rem; font-weight: 700; margin-bottom: 20px; color: var(--text-main); }
        
        .main-icon { width: 120px; height: 120px; margin: 10px auto; }
        
        .temp-section { margin: 20px 0; }
        .temp { font-size: 3.5rem; font-weight: 800; color: var(--text-main); letter-spacing: -2px; }
        .desc { font-size: 1.2rem; color: #666; margin-top: 5px; }

        /* å»ºè­°å€å¡Š (ä½ çš„æ ¸å¿ƒéœ€æ±‚) */
        .advice-box {
            background: #F0F3F6;
            border-radius: 16px;
            padding: 15px;
            margin-top: 25px;
            text-align: left;
        }
        .advice-item { display: flex; align-items: flex-start; margin-bottom: 12px; }
        .advice-item:last-child { margin-bottom: 0; }
        .advice-icon { font-size: 1.5rem; margin-right: 12px; min-width: 30px; }
        .advice-text { font-size: 1rem; line-height: 1.4; }
        .highlight { color: var(--rain-color); font-weight: bold; }
        .warm { color: var(--accent); font-weight: bold; }

        /* ä¸‹æ‹‰é¸å–® */
        select {
            padding: 10px;
            border-radius: 12px;
            border: 1px solid #ddd;
            font-size: 1rem;
            background: white;
            margin-top: 20px;
            width: 100%;
            max-width: 200px;
        }

        .loading { opacity: 0.5; pointer-events: none; }
        
        /* æœªä¾†é å ±ç°¡åŒ–ç‰ˆ */
        .forecast-row {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .forecast-item { text-align: center; font-size: 0.9rem; }
        .f-time { color: #999; margin-bottom: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="weather-card" id="card">
        <h1>ç¾åœ¨ä½ç½®</h1>
        <div class="location" id="locationDisplay">è¼‰å…¥ä¸­...</div>
        
        <!-- é€™æ˜¯ä¸€å€‹ç´” CSS/SVG çš„å¯æ„›å¤ªé™½/é›²åœ–ç¤ºï¼Œä¸éœ€è¦å¤–éƒ¨åœ–ç‰‡ -->
        <div id="weatherIconContainer">
            <svg class="main-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="30" fill="#FFD93D" />
                <g id="rays">
                    <line x1="50" y1="10" x2="50" y2="5" stroke="#FFD93D" stroke-width="6" stroke-linecap="round"/>
                    <line x1="50" y1="90" x2="50" y2="95" stroke="#FFD93D" stroke-width="6" stroke-linecap="round"/>
                    <line x1="10" y1="50" x2="5" y2="50" stroke="#FFD93D" stroke-width="6" stroke-linecap="round"/>
                    <line x1="90" y1="50" x2="95" y2="50" stroke="#FFD93D" stroke-width="6" stroke-linecap="round"/>
                </g>
            </svg>
        </div>

        <div class="temp-section">
            <div class="temp" id="temp">--Â°</div>
            <div class="desc" id="desc">æ­£åœ¨æŠ“å–è³‡æ–™...</div>
        </div>

        <!-- æ ¸å¿ƒï¼šç©¿è¡£èˆ‡å¸¶å‚˜å»ºè­° -->
        <div class="advice-box">
            <div class="advice-item">
                <span class="advice-icon">ğŸŒ‚</span>
                <div class="advice-text" id="rainAdvice">è®€å–é™é›¨æ©Ÿç‡ä¸­...</div>
            </div>
            <div class="advice-item">
                <span class="advice-icon">ğŸ‘•</span>
                <div class="advice-text" id="clothAdvice">è®€å–æ°£æº«å»ºè­°ä¸­...</div>
            </div>
        </div>

        <div class="forecast-row" id="forecast">
            <!-- æœªä¾†é å ±æœƒæ’å…¥é€™è£¡ -->
        </div>
    </div>

    <select id="citySelect" onchange="manualSelectCity()">
        <option value="" disabled selected>æ‰‹å‹•é¸æ“‡ç¸£å¸‚</option>
        <!-- JS æœƒè‡ªå‹•å¡«å…¥é¸é … -->
    </select>

    <script>
        // ================= è¨­å®šå€ =================
        const API_KEY = "CWA-7789A37A-97C4-4BA9-9777-90C7E8741D62";
        const API_URL = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=${API_KEY}&format=JSON`;

        const cities = ["è‡ºåŒ—å¸‚", "æ–°åŒ—å¸‚", "æ¡ƒåœ’å¸‚", "è‡ºä¸­å¸‚", "è‡ºå—å¸‚", "é«˜é›„å¸‚", "åŸºéš†å¸‚", "æ–°ç«¹ç¸£", "æ–°ç«¹å¸‚", "è‹—æ —ç¸£", "å½°åŒ–ç¸£", "å—æŠ•ç¸£", "é›²æ—ç¸£", "å˜‰ç¾©ç¸£", "å˜‰ç¾©å¸‚", "å±æ±ç¸£", "å®œè˜­ç¸£", "èŠ±è“®ç¸£", "è‡ºæ±ç¸£", "æ¾æ¹–ç¸£", "é‡‘é–€ç¸£", "é€£æ±Ÿç¸£"];

        // åˆå§‹åŒ–ä¸‹æ‹‰é¸å–®
        const select = document.getElementById('citySelect');
        cities.forEach(city => {
            let option = document.createElement('option');
            option.value = city;
            option.text = city;
            select.appendChild(option);
        });

        // ================= æ ¸å¿ƒé‚è¼¯ =================

        async function init() {
            // é è¨­å…ˆæŠ“å°åŒ—ï¼Œéš¨å¾Œå˜—è©¦å®šä½
            fetchWeather("æ–°åŒ—å¸‚"); 
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    // é€™è£¡ç‚ºäº†ç°¡åŒ– MVPï¼Œæˆ‘å€‘ç›´æ¥ç”¨ API å›å‚³çš„ç¸£å¸‚æ¸…å–®è®“ä½¿ç”¨è€…é¸ï¼Œ
                    // æˆ–æ˜¯å¦‚æœä½ æƒ³æ›´ç²¾ç¢ºï¼Œéœ€è¦åå‘åœ°ç†ç·¨ç¢¼ (Reverse Geocoding)ã€‚
                    // ç‚ºä¿æŒç°¡å–®ï¼Œæˆ‘å€‘é è¨­æœƒæç¤ºä½¿ç”¨è€…ç¢ºèªä½ç½®ã€‚
                    console.log("å–å¾—åº§æ¨™:", position.coords);
                    // å¯¦éš›å°ˆæ¡ˆå¯æ¥ Google Maps API è½‰ç¸£å¸‚ï¼Œé€™é‚Šå…ˆä¿ç•™æ‰‹å‹•åŠŸèƒ½
                });
            }
        }

        async function fetchWeather(locationName) {
            document.getElementById('card').classList.add('loading');
            try {
                const url = `${API_URL}&locationName=${locationName}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success === "true") {
                    const records = data.records.location[0];
                    renderUI(records);
                }
            } catch (error) {
                alert("å¤©æ°£è³‡æ–™æŠ“å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯");
                console.error(error);
            } finally {
                document.getElementById('card').classList.remove('loading');
            }
        }

        function renderUI(data) {
            document.getElementById('locationDisplay').innerText = data.locationName;

            // è§£æ CWA è³‡æ–™çµæ§‹ (Wx:å¤©æ°£, PoP:é™é›¨, MinT:ä½æº«, CI:èˆ’é©åº¦, MaxT:é«˜æº«)
            const weatherElements = {};
            data.weatherElement.forEach(el => {
                weatherElements[el.elementName] = el.time;
            });Reload Window

            // å–å¾—æœ€è¿‘çš„ä¸€å€‹æ™‚æ®µ (ä»Šæ™šæˆ–æ˜å¤©ç™½å¤©)
            const now = weatherElements['Wx'][0];
            const wx = now.parameter.parameterName;
            const pop = weatherElements['PoP'][0].parameter.parameterName; // é™é›¨æ©Ÿç‡ %
            const minT = weatherElements['MinT'][0].parameter.parameterName;
            const maxT = weatherElements['MaxT'][0].parameter.parameterName;
            const ci = weatherElements['CI'][0].parameter.parameterName; // èˆ’é©åº¦æè¿°

            // 1. æ›´æ–°ä¸»ç•«é¢
            document.getElementById('temp').innerText = `${minT}-${maxT}Â°`;
            document.getElementById('desc').innerText = `${wx} | é™é›¨æ©Ÿç‡ ${pop}%`;

            // 2. ç”¢ç”Ÿå»ºè­° (ä½ çš„æ ¸å¿ƒéœ€æ±‚)
            generateAdvice(pop, parseInt(minT), parseInt(maxT), ci);

            // 3. æ›´æ–° Icon (ç°¡å–®åˆ¤æ–·)
            updateIcon(wx, pop);

            // 4. æœªä¾†é æ¸¬ (Next 12-24hr)
            const next = weatherElements['Wx'][1];
            const nextTime = new Date(next.startTime).getHours();
            const timeLabel = nextTime >= 18 ? "ä»Šæ™šæ˜æ™¨" : "æ˜å¤©ç™½å¤©";
            
            document.getElementById('forecast').innerHTML = `
                <div class="forecast-item">
                    <div class="f-time">${timeLabel}</div>
                    <div>${next.parameter.parameterName}</div>
                    <div>${weatherElements['MinT'][1].parameter.parameterName}-${weatherElements['MaxT'][1].parameter.parameterName}Â°</div>
                </div>
                <div class="forecast-item">
                    <div class="f-time">é™é›¨æ©Ÿç‡</div>
                    <div style="font-weight:bold; color:#54A0FF">${weatherElements['PoP'][1].parameter.parameterName}%</div>
                </div>
            `;
        }

        function generateAdvice(pop, minT, maxT, ci) {
            // å‚˜çš„å»ºè­°
            let rainText = "";
            if (parseInt(pop) >= 50) {
                rainText = "<span class='highlight'>ä¸€å®šè¦å¸¶å‚˜ï¼</span> ä¸‹é›¨æ©Ÿç‡å¾ˆé«˜ï¼Œåˆ¥æ·‹æ¿•äº†ã€‚";
            } else if (parseInt(pop) >= 30) {
                rainText = "å»ºè­°å¸¶æŠŠå‚˜ï¼Œå¤©æ°£ä¸å¤ªç©©å®šå–”ã€‚";
            } else {
                rainText = "æ‡‰è©²ä¸ç”¨å¸¶å‚˜ï¼Œäº«å—å¥½å¤©æ°£ï¼";
            }
            document.getElementById('rainAdvice').innerHTML = rainText;

            // è¡£æœå»ºè­° (é€™è£¡ä½ å¯ä»¥ä¾æ“šè‡ªå·±çš„é«”æ„Ÿèª¿æ•´)
            let clothText = "";
            const avgTemp = (minT + maxT) / 2;

            if (avgTemp < 15) {
                clothText = "<b>å¾ˆå†·å–”ï¼</b> è«‹ç©¿è‘—åšå¤–å¥—ã€ç™¼ç†±è¡£ï¼Œæ³¨æ„ä¿æš–ã€‚";
            } else if (avgTemp < 20) {
                clothText = "æœ‰é»æ¶¼ï¼Œå»ºè­°æ´‹è”¥å¼ç©¿æ­ï¼Œå¸¶ä»¶<b>è–„å¤–å¥—</b>å‡ºé–€ã€‚";
            } else if (avgTemp < 26) {
                clothText = "<b>èˆ’é©ï¼</b> çŸ­è¢–æ­é…è–„è¥¯è¡«æˆ–é•·è¢–Tæ¤å‰›å¥½ã€‚";
            } else {
                clothText = "<span class='warm'>å¾ˆç†±ï¼</span> çŸ­è¢–çŸ­è¤²å³å¯ï¼Œæ³¨æ„é˜²æ›¬èˆ‡è£œæ°´ã€‚";
            }
            document.getElementById('clothAdvice').innerHTML = clothText;
        }

        function updateIcon(wx, pop) {
            // ç°¡å–®çš„åœ–ç¤ºåˆ‡æ›é‚è¼¯
            // é€™è£¡å¯ä»¥ç”¨æ›´è¤‡é›œçš„ SVG æ›¿æ›ï¼ŒMVP å…ˆç¤ºç¯„é‚è¼¯
            const container = document.getElementById('weatherIconContainer');
            if (wx.includes("é›¨") || parseInt(pop) > 50) {
                // æ›æˆé›¨å¤© SVG (ç”¨ JS ç•«)
                container.innerHTML = `<svg class="main-icon" viewBox="0 0 100 100"><path d="M30,50 Q40,35 55,35 T80,50 A20,20 0 0,1 80,80 A20,20 0 0,1 40,80 A15,15 0 0,1 30,50" fill="#ddd"/><line x1="45" y1="85" x2="40" y2="95" stroke="#54A0FF" stroke-width="3"/><line x1="60" y1="85" x2="55" y2="95" stroke="#54A0FF" stroke-width="3"/></svg>`;
            } else if (wx.includes("é›²") || wx.includes("é™°")) {
                // é™°å¤©
                container.innerHTML = `<svg class="main-icon" viewBox="0 0 100 100"><path d="M30,50 Q40,35 55,35 T80,50 A20,20 0 0,1 80,80 A20,20 0 0,1 40,80 A15,15 0 0,1 30,50" fill="#dcdcdc"/></svg>`;
            } else {
                // æ™´å¤© (é è¨­)
                container.innerHTML = `<svg class="main-icon" viewBox="0 0 100 100"><circle cx="50" cy="50" r="25" fill="#FFD93D" /><g stroke="#FFD93D" stroke-width="5"><line x1="50" y1="10" x2="50" y2="15"/><line x1="50" y1="85" x2="50" y2="90"/><line x1="10" y1="50" x2="15" y2="50"/><line x1="85" y1="50" x2="90" y2="50"/></g></svg>`;
            }
        }

        function manualSelectCity() {
            const city = document.getElementById('citySelect').value;
            fetchWeather(city);
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
git status
git add .
git commit -m "Save local changes before moving to new repo"